!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):r.urlComposer=n()}(this,function(){"use strict";function r(r){return"[object Array]"===Object.prototype.toString.call(r)}function n(r){if(null==r)return!0;if(r.length>0)return!1;if(0===r.length)return!0;if("object"!=typeof r)return!0;for(var n in r)if(hasOwnProperty.call(r,n))return!1;return!0}function t(r,n){return r=r||"",n=n||[],T.isEmpty(n)?u(r):(r=e(r,n),i(A(r)))}function e(r,n){if(n=n||[],!T.isArray(n)){var t=r.match(I.NAMED_PARAMS);t&&(n=t.map(function(r){return n[r.substr(1)]}))}T.isArray(n)&&n.forEach(function(n){n&&(r=a(r,n))});var e=r.match(I.OPTIONAL_PARAMS);return e&&e.forEach(function(n){o(n)&&(r=r.replace(n,""))}),r}function a(r,n){var t=r.indexOf(":")!==-1;return n=encodeURIComponent(n),t?r.replace(I.NAMED_PARAM,n):r.replace(I.SPLAT_PARAMS,n)}function o(r){return I.NAMED_PARAM.test(r)||I.SPLAT_PARAMS.test(r)}function u(r){return r.replace(I.OPTIONAL_PARAMS,"")}function i(r){return r.replace(I.TRAILING_SLASH,"")}function c(r){return r.replace(I.LEADING_SLASH,"")}function A(r){return r.replace(I.PARENTHESES,"")}function s(r){var n=r.host,t=r.path,e=r.query,a=r.hash;return n=i(n),t=i(c(t)),t=t?"/"+t:"",e=e?"?"+e:"",a=a?"#"+a:"",""+n+t+e+a}function f(r,n){for(var t=[],e=0;e<r.length;e++){var a=r[e];a[n]&&""===a.value&&t.push(a)}return t}function p(r){return{named:r&&r.match(I.NAMED_PARAMS)||[],splat:r&&r.match(I.SPLAT_PARAMS)||[]}}function l(r){return r=r.replace(I.ESCAPE,"\\$&").replace(I.OPTIONAL_PARAMS,"(?:$1)?").replace(I.NAMED_PARAMS,function(r,n){return n?r:"([^/?]+)"}).replace(I.SPLAT_PARAMS,"([^?]*?)"),new RegExp("^"+r+"(?:\\?([\\s\\S]*))?$")}function h(r){return r=r||{},q.compose(r.path,r.params)}function P(r){var n=[];r=r||{};for(var t in r.query){var e=r.query[t];n.push(t+"="+encodeURIComponent(e))}return n.length?n.join("&"):""}function m(r){r=r||{};var n=l(r.path);return n.test(r.url)}function S(r){r=r||{},r.host=r.host||"";var n=h(r),t=P(r);return q.concat({host:r.host,path:n,query:t,hash:r.hash})}function E(r,n){function t(r){e[r.slice(1)]=n[o++]}var e={},a=p(r),o=0;return a.named.forEach(t),a.splat.forEach(t),e}function R(r,n){var t=r.match(I.OPTIONAL_PARAMS)||[],e=p(r),a=e.named,o=e.splat,u=a.concat(o);return n=n||{},T.isArray(n)&&(n=E(r,n)),u=u.map(function(r){for(var e=!1,a=0;a<t.length;a++){var o=t[a];if(o.indexOf(r)!==-1){e=!0;break}}return{name:r,value:n[r.slice(1)]||"",optional:e,required:!e}}),{params:u,hasOptionalParams:I.OPTIONAL_PARAMS.test(r),missingOptionalParams:q.test(u,"optional"),missingRequiredParams:q.test(u,"required"),missingParams:q.test(u,"name")}}function M(r){void 0===r&&(r={});var n=r.path,t=r.definition,e=r.object;if(!n&&!t)throw new Error("url-composer: Missing path and definition");var a=l(t),o=a.exec(n);if(!o)return null;o=o.slice(1);var u=o.map(function(r,n){return n===o.length-1?r||null:r?decodeURIComponent(r):null});if(e){var i=u.pop();u=E(t,u),u.query=i}return u}var d=/\/$/,v=/^\//,_=/[()]/g,y=/\((.*?)\)/g,L=/\*\w+/g,N=/(\(\?)?:\w+/,g=/(\(\?)?:\w+/g,O=/[-{}[\]+?.,\\^$|#\s]/g,I={TRAILING_SLASH:d,LEADING_SLASH:v,PARENTHESES:_,OPTIONAL_PARAMS:y,SPLAT_PARAMS:L,NAMED_PARAM:N,NAMED_PARAMS:g,ESCAPE:O},T={isArray:r,isEmpty:n},q={compose:t,concat:s,test:f},D={build:S,test:m,stats:R,parse:M,params:E,path:h,query:P,regex:l,match:p};return D});
